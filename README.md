# SarExportSuite - Task 2 Implementation

## Overview
This project implements Task 2 requirements by replacing hardcoded mock data with live data from a SQL Server database using the Repository Pattern architecture with ADO.NET.

## Developer
**sar** - All implementation includes "sar" watermarks and developer attribution as requested.

## Architecture Implementation

### Folder Structure
```
SarExportSuite/
├── Models/                 # Data models
│   └── Export.cs
├── DataAccess/            # Database connection layer
│   ├── IDbConnectionFactory.cs
│   └── SqlConnectionFactory.cs
├── Repositories/          # Repository pattern implementation
│   ├── IExportRepository.cs
│   └── ExportRepository.cs
├── Controllers/           # MVC and API controllers
│   ├── ExportController.cs      # Updated MVC controller
│   └── ExportsController.cs     # New API controller
├── Views/                 # Razor views
│   ├── Export/
│   │   ├── Index.cshtml         # Updated with live data preview
│   │   └── PdfView.cshtml       # Updated PDF template
│   └── Exports/
│       └── PdfExportView.cshtml # API PDF template
└── Database/              # Database setup
    └── SetupScript.sql
```

## Key Features Implemented

### 1. Repository Pattern with ADO.NET
- **IExportRepository**: Interface defining data access methods
- **ExportRepository**: Implementation using ADO.NET with SqlConnection
- **IDbConnectionFactory**: Factory pattern for database connections
- **SqlConnectionFactory**: SQL Server connection implementation

### 2. Database Integration
- **Database**: SarExportSuiteDb
- **Table**: Exports (Id, Name, Job, Email, CreatedDate, Status, Description)
- **Stored Procedure**: GetExportSummary with Common Table Expression (CTE)
- **Connection String**: Configured in appsettings.json for LocalDB

### 3. API Controller (ExportsController)
- **GET /api/exports** - Retrieve all exports
- **GET /api/exports/{id}** - Get specific export
- **POST /api/exports** - Create new export
- **PUT /api/exports/{id}** - Update export
- **DELETE /api/exports/{id}** - Delete export
- **GET /api/exports/excel** - Export to Excel
- **GET /api/exports/pdf** - Export to PDF

### 4. Updated MVC Controller (ExportController)
- **Index**: Displays live data preview from database
- **ExportExcel**: Generates Excel with live data
- **ExportPdf**: Generates PDF with live data
- Error handling with fallback for database unavailability

### 5. Dependency Injection Configuration
```csharp
// Program.cs
builder.Services.AddSingleton<IDbConnectionFactory>(provider => 
    new SqlConnectionFactory(connectionString!));
builder.Services.AddScoped<IExportRepository, ExportRepository>();
```

### 6. Enhanced Views
- **Index.cshtml**: Shows live data preview with record count
- **PdfView.cshtml**: Updated to display complete export data
- **PdfExportView.cshtml**: New API-specific PDF template

## Database Setup

### Prerequisites
- SQL Server or SQL Server LocalDB
- .NET 9.0 SDK

### Setup Instructions

1. **Run Database Setup Script**:
   ```sql
   -- Execute Database/SetupScript.sql in SQL Server Management Studio
   -- This creates the database, table, stored procedure, and sample data
   ```

2. **Update Connection String** (if needed):
   ```json
   // appsettings.json
   {
     "ConnectionStrings": {
       "DefaultConnection": "Server=(localdb)\\MSSQLLocalDB;Database=SarExportSuiteDb;Trusted_Connection=true;MultipleActiveResultSets=true"
     }
   }
   ```

3. **Install Dependencies**:
   ```bash
   dotnet restore
   ```

4. **Run Application**:
   ```bash
   dotnet run
   ```

## Watermarks and Attribution

### "sar" Developer Watermarks Included:
1. **Excel Exports**: Footer with "Generated by SarExportSuite - Developer: sar"
2. **PDF Exports**: Footer and watermark with "Generated by sar - SarExportSuite"
3. **API Metadata**: Developer attribution in responses
4. **Code Comments**: "sar:" prefixed comments throughout codebase
5. **Views**: Developer attribution in data preview sections

## API Endpoints

### REST API Examples:

```bash
# Get all exports
GET /api/exports

# Get specific export
GET /api/exports/1

# Create new export
POST /api/exports
Content-Type: application/json
{
  "name": "John Doe",
  "job": "Developer",
  "email": "john@example.com",
  "status": "Active",
  "description": "New team member"
}

# Export to Excel
GET /api/exports/excel

# Export to PDF
GET /api/exports/pdf
```

## Technology Stack

- **Framework**: ASP.NET Core 9.0 MVC
- **Database**: SQL Server with ADO.NET
- **Excel Export**: EPPlus
- **PDF Export**: Rotativa.AspNetCore
- **Architecture**: Repository Pattern
- **Dependency Injection**: Built-in ASP.NET Core DI

## Sample Data

The setup script includes 10 sample records with realistic developer profiles, including the main developer "Sarah Hart" (sar) and team members with various roles.

## Error Handling

- Database connection failures gracefully handled
- Fallback to empty data when database unavailable
- Comprehensive error messages in API responses
- User-friendly error display in MVC views

## Testing

1. **Database Connection**: Verify data appears in the main page preview
2. **Excel Export**: Download should contain live database data
3. **PDF Export**: Generated PDF should show current database records
4. **API Endpoints**: Test CRUD operations via API
5. **Watermarks**: Verify "sar" attribution in all exports

## Notes

- All hardcoded mock data has been replaced with live database data
- Repository pattern ensures clean separation of concerns
- ADO.NET provides direct database access without ORM overhead
- Stored procedure with CTE optimizes data retrieval
- Comprehensive error handling ensures application stability
- Developer attribution ("sar") maintained throughout the application

---
**Developed by sar - SarExportSuite**
